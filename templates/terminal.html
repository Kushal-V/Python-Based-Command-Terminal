<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyTerm - Natural Language Terminal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100vh;
            overflow: hidden;
        }

        .container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: #2d2d30;
            padding: 15px 20px;
            border-bottom: 1px solid #3e3e42;
        }

        .header h1 {
            color: #d4d4d4;
            font-size: 1.4em;
            margin-bottom: 5px;
            font-weight: normal;
        }

        .header p {
            color: #969696;
            font-size: 0.9em;
        }

        .terminal-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow: hidden;
        }

        .terminal {
            background: #1e1e1e;
            border: 1px solid #3e3e42;
            border-radius: 4px;
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .terminal-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #3e3e42;
        }

        .terminal-buttons {
            display: flex;
            gap: 8px;
            margin-right: 15px;
        }

        .terminal-button {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .close { background: #ff6058; }
        .minimize { background: #ffbd2e; }
        .maximize { background: #28ca42; }

        .terminal-title {
            color: #969696;
            font-size: 0.9em;
        }

        .output-container {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            max-height: calc(100vh - 200px);
        }

        .output-line {
            margin-bottom: 8px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .prompt {
            color: #569cd6;
        }

        .command {
            color: #d4d4d4;
        }

        .output {
            color: #cccccc;
            margin-left: 0;
        }

        .error {
            color: #f44747;
        }

        .interpretation {
            color: #dcdcaa;
            font-style: italic;
            margin-left: 0;
        }

        .input-container {
            display: flex;
            align-items: center;
            background: #2d2d30;
            border: 1px solid #3e3e42;
            border-radius: 3px;
            padding: 8px 12px;
        }

        .current-prompt {
            color: #569cd6;
            margin-right: 8px;
            white-space: nowrap;
        }

        .command-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            outline: none;
        }

        .command-input::placeholder {
            color: #6a6a6a;
        }

        .loading {
            color: #dcdcaa;
        }

        .help-hint {
            background: #2d2d30;
            border: 1px solid #3e3e42;
            border-radius: 3px;
            padding: 12px;
            margin-bottom: 15px;
            color: #969696;
            font-size: 0.9em;
        }

        /* Scrollbar styling */
        .output-container::-webkit-scrollbar {
            width: 6px;
        }

        .output-container::-webkit-scrollbar-track {
            background: #2d2d30;
        }

        .output-container::-webkit-scrollbar-thumb {
            background: #569cd6;
            border-radius: 3px;
        }

        .output-container::-webkit-scrollbar-thumb:hover {
            background: #4e8bc4;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.4em;
            }
            
            .terminal-container {
                padding: 10px;
            }
            
            .terminal {
                padding: 15px;
            }
            
            .command-input {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PyTerm - Natural Language Terminal</h1>
            <p>Type commands naturally or use traditional terminal syntax - Now working with your real OS!</p>
        </div>
        
        <div class="terminal-container">
            <div class="terminal">
                <div class="terminal-header">
                    <div class="terminal-buttons">
                        <div class="terminal-button close"></div>
                        <div class="terminal-button minimize"></div>
                        <div class="terminal-button maximize"></div>
                    </div>
                    <div class="terminal-title" id="terminalTitle">PyTerm v1.0 - Connected</div>
                </div>
                
                <div class="help-hint">
                    Try natural language commands like "show me what's in this directory" or "create a folder called test"<br>
                    üñ•Ô∏è <strong>Real OS Mode:</strong> Commands will affect your actual file system (with security restrictions)
                </div>
                
                <div class="output-container" id="output"></div>
                
                <div class="input-container">
                    <span class="current-prompt" id="prompt">~</span>
                    <span class="prompt">$</span>
                    <input type="text" class="command-input" id="commandInput" 
                           placeholder="Type a command or describe what you want to do..." 
                           autocomplete="off">
                </div>
            </div>
        </div>
    </div>

    <script>
        const output = document.getElementById('output');
        const commandInput = document.getElementById('commandInput');
        const promptElement = document.getElementById('prompt');
        let commandHistory = [];
        let historyIndex = -1;

        // Focus input on page load
        commandInput.focus();

        // Handle command submission
        commandInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                executeCommand();
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                navigateHistory(-1);
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                navigateHistory(1);
            } else if (e.key === 'Tab') {
                e.preventDefault();
                // Could implement autocomplete here
            }
        });

        // Handle clicking anywhere to focus input
        document.addEventListener('click', function() {
            commandInput.focus();
        });

        function navigateHistory(direction) {
            if (commandHistory.length === 0) return;
            
            historyIndex += direction;
            
            if (historyIndex < 0) {
                historyIndex = -1;
                commandInput.value = '';
            } else if (historyIndex >= commandHistory.length) {
                historyIndex = commandHistory.length - 1;
            }
            
            if (historyIndex >= 0) {
                commandInput.value = commandHistory[historyIndex];
            }
        }

        function addToOutput(content, className = '') {
            const line = document.createElement('div');
            line.className = `output-line ${className}`;
            line.textContent = content;
            output.appendChild(line);
            scrollToBottom();
        }

        function addPromptLine(promptText, command) {
            const line = document.createElement('div');
            line.className = 'output-line';
            line.innerHTML = `<span class="prompt">${promptText} $ </span><span class="command">${command}</span>`;
            output.appendChild(line);
            scrollToBottom();
        }

        function scrollToBottom() {
            output.scrollTop = output.scrollHeight;
        }

        function clearTerminal() {
            output.innerHTML = '';
        }

        async function executeCommand() {
            const command = commandInput.value.trim();
            if (!command) return;

            // Add command to history
            commandHistory.push(command);
            historyIndex = -1;

            // Show the command in output
            addPromptLine(promptElement.textContent, command);

            // Clear input and show loading
            commandInput.value = '';
            commandInput.placeholder = 'Processing...';
            commandInput.disabled = true;

            try {
                const response = await fetch('/execute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ command: command })
                });

                const result = await response.json();

                // Show interpretation if available
                if (result.interpretation) {
                    addToOutput(result.interpretation, 'interpretation');
                }

                // Handle clear command
                if (result.output === 'CLEAR_TERMINAL') {
                    clearTerminal();
                } else {
                    // Show output
                    if (result.output) {
                        addToOutput(result.output, 'output');
                    }
                    
                    // Show error
                    if (result.error) {
                        addToOutput(result.error, 'error');
                    }
                }

                // Update prompt and mode info
                if (result.prompt) {
                    promptElement.textContent = result.prompt;
                }
                
                // Update terminal title with mode
                if (result.mode) {
                    const terminalTitle = document.getElementById('terminalTitle');
                    terminalTitle.textContent = `PyTerm v1.0 - ${result.mode.mode} MODE`;
                }

            } catch (error) {
                addToOutput(`Network error: ${error.message}`, 'error');
            } finally {
                // Re-enable input
                commandInput.disabled = false;
                commandInput.placeholder = 'Type a command or describe what you want to do...';
                commandInput.focus();
            }
        }

        // Welcome message
        addToOutput('Welcome to PyTerm!', 'output');
        addToOutput('Detecting environment...', 'output');
        
        // Get initial mode info
        fetch('/execute', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ command: 'mode' })
        }).then(response => response.json()).then(result => {
            if (result.mode) {
                const terminalTitle = document.getElementById('terminalTitle');
                terminalTitle.textContent = `PyTerm v1.0 - ${result.mode.mode} MODE`;
                
                if (result.mode.mode === 'SANDBOX') {
                    addToOutput('‚ö° SANDBOX MODE: Safe demonstration environment', 'output');
                    addToOutput('üîí Security: Files are temporary and isolated', 'output');
                    addToOutput('üì• For full OS access, download the local version', 'output');
                } else {
                    addToOutput('‚ö° REAL OS MODE: Commands will interact with your actual file system', 'output');
                    addToOutput('üîí Security: Operations are restricted to safe directories', 'output');
                }
            }
            
            addToOutput('You can use natural language or traditional terminal commands.', 'output');
            addToOutput('Type "help" for available commands or try phrases like:', 'output');
            addToOutput('  ‚Ä¢ "show me what\'s in this directory"', 'output');
            addToOutput('  ‚Ä¢ "create a folder called test"', 'output');
            addToOutput('  ‚Ä¢ "go to the documents folder"', 'output');
            addToOutput('  ‚Ä¢ "where am I right now?"', 'output');
            addToOutput('', 'output');
        });
    </script>
</body>
</html>
